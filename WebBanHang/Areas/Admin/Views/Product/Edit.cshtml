@model ProductModel
@{
    ViewData["title"] = "Edit Product";
}
<h1>Edit</h1>


<div class="col-md-9">
    <form asp-action="Edit" enctype="multipart/form-data">

        <div class="form-group">
            <label asp-for="ProductID"></label>
            <input asp-for="ProductID" class="form-control" readonly />
            <span asp-validation-for="ProductID" class="text-danger"></span>
        </div>


        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

        <div class="form-group">
            <label>Name</label>
            <input asp-for="NameProduct" class="form-control" />
            <span asp-validation-for="NameProduct" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label>Price</label>
            <input asp-for="Price" pattern="[0-9.,]+" class="form-control typing-price" />
            <span id="price-convert"></span>
            <span asp-validation-for="Price" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label>Description</label>
            <textarea asp-for="Description" class="form-control"></textarea>
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label>Category</label>
            <select asp-for="CategoryID" class="form-control" asp-items="ViewBag.Categories">
                <option value="">-- Choose a category --</option>
            </select>
            <span asp-validation-for="CategoryID" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label>Brand</label>
            <select asp-for="BrandID" class="form-control" asp-items="ViewBag.Brands">
                <option value="">-- Choose a brand --</option>
            </select>
            <span asp-validation-for="BrandID" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label>Stock</label>
            <input asp-for="Stock" type="number" class="form-control" min="0" />
            <span asp-validation-for="Stock" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label>Operating System</label>
            <select asp-for="OperatingSystemID" class="form-control" asp-items="ViewBag.OperatingSystem">
                <option value="">-- Choose an operating system --</option>
            </select>
            <span asp-validation-for="OperatingSystemID" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label>Thêm ảnh mới</label>
            <input asp-for="ImageUpload" type="file" class="form-control" multiple id="ImageUpload" />
            <span asp-validation-for="ImageUpload" class="text-danger"></span>

            <!-- khung preview ảnh -->
            <div id="previewContainer" style="margin-top:10px; display:flex; flex-wrap:wrap; gap:10px;"></div>
        </div>

        <script>
            document.getElementById('ImageUpload').addEventListener('change', function () {
                const previewContainer = document.getElementById('previewContainer');
                previewContainer.innerHTML = ""; // xoá preview cũ

                Array.from(this.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = e => {
                        const img = document.createElement("img");
                        img.src = e.target.result;
                        img.style.width = "100px";
                        img.style.height = "100px";
                        img.style.objectFit = "cover";
                        img.style.border = "1px solid #ccc";
                        previewContainer.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
            });
        </script>


       

       
        <div class="form-group">
            <button class="btn btn-primary">Update</button>
        </div>
    </form> <!-- kết thúc form Edit ở đây -->
        <!-- Danh sách ảnh và form xóa riêng -->
    <h3>Ảnh hiện tại</h3>
    <div style="display:flex; flex-wrap:wrap; gap:15px;">
        @if (Model.ProductImage != null && Model.ProductImage.Any())
        {
            foreach (var img in Model.ProductImage)
            {
                var isMain = img.IsMain ? "2px solid red" : "1px solid #ccc";

                <div style="width:130px; text-align:center; display:flex; flex-direction:column; align-items:center;">
                    <!-- Ảnh -->
                    <img src="/media/products/@img.ImageUrl"
                         style="width:120px; height:120px; object-fit:cover; border:@isMain;" />

                    <!-- Hai nút nhỏ dưới ảnh -->
                    <div style="margin-top:5px; display:flex; gap:6px; justify-content:center;">
                        <!-- Nút Set -->
                        <form asp-action="SetMainImage" method="post" style="margin:0;">
                            <input type="hidden" name="imageId" value="@img.ImageID" />
                            <input type="hidden" name="productId" value="@Model.ProductID" />
                            <button type="submit" class="btn btn-sm btn-success" style="padding:2px 8px; font-size:12px;">
                                ✔ SetAvt
                            </button>
                        </form>

                        <!-- Nút Xóa -->
                        <form asp-action="DeleteImage" method="post" style="margin:0;"
                              onsubmit="return confirm('Bạn có chắc muốn xóa ảnh này không?');">
                            <input type="hidden" name="imageId" value="@img.ImageID" />
                            <input type="hidden" name="productId" value="@Model.ProductID" />
                            <button type="submit" class="btn btn-sm btn-outline-danger" style="padding:2px 8px; font-size:12px;">
                                ✖ Xóa
                            </button>
                        </form>
                    </div>
                </div>
            }
        }
        else
        {
            <p><i>Chưa có ảnh nào</i></p>
        }
    </div>


    
    <a asp-action="Index">Back to list product</a>
    <

    @section Scripts {
        @{
            await Html.RenderPartialAsync("_ValidationScriptsPartial.cshtml");
        }
      
    }


    

