@model WebBanHang.Models.ProductModel
<div class="row">
	<div class="col-sm-3">
		@Html.Partial("_SidebarParticial")
	</div>

	<div class="col-sm-9 padding-right">
		<div class="product-details">
			<!--product-details-->
			<div class="col-sm-5">
				<div id="similar-product" class="carousel slide" data-ride="carousel">
					<!-- Wrapper for slides -->
					<div class="carousel-inner">
						@{
							if (Model.ProductImage != null && Model.ProductImage.Any())
							{
								int count = 0;
								foreach (var img in Model.ProductImage)
								{
									var activeClass = count == 0 ? "active" : "";
									<div class="item @activeClass">
										<img src="/media/products/@img.ImageUrl"
											 alt="@Model.NameProduct"
											 style="width:100%; max-height:500px; object-fit:contain; margin:0 auto;" />
									</div>
									;
									count++;
								}
							}
							else
							{
								<div class="item active">
									<img src="/images/no-image-available.jpg"
										 alt="No image"
										 style="max-height:300px; margin:0 auto;" />
								</div>
								;
							}
						}
					</div>

					<!-- Controls -->
					<a class="left item-control" href="#similar-product" data-slide="prev">
						<i class="fa fa-angle-left"></i>
					</a>
					<a class="right item-control" href="#similar-product" data-slide="next">
						<i class="fa fa-angle-right"></i>
					</a>
				</div>





			</div>
			<div class="col-sm-7">
				<div class="product-information p-4" style="border:1px solid #eee; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.05); background:#fff;">
					<h3 style="border-bottom:2px solid #f1f1f1; padding-bottom:10px; margin-bottom:20px; font-weight:700; color:#333;">
						<i class="fa fa-info-circle"></i> Chi tiết sản phẩm
					</h3>

					<h2 style="font-size:26px; font-weight:700; margin-bottom:15px; color:#222;">
						<i class="fa fa-laptop"></i> @Model.NameProduct
					</h2>

					<p><i class="fa fa-barcode"></i> <strong>ID Sản phẩm:</strong> @Model.ProductID</p>
					<p><i class="fa fa-industry"></i> <strong>Thương hiệu:</strong> @Model.Brand?.NameBrand</p>
					<p><i class="fa fa-cogs"></i> <strong>Hệ điều hành:</strong> @Model.OperatingSystem?.OperatingSystemName</p>
					<p><i class="fa fa-tags"></i> <strong>Kiểu máy:</strong> @Model.Category?.CategoryName</p>
					<p><i class="fa fa-align-left"></i> <strong>Mô tả:</strong> @Model.Description</p>
					<p>
						<i class="fa fa-money"></i> <strong>Giá:</strong>
						<span style="color:#e74c3c; font-size:22px; font-weight:700;">@Model.Price.ToString("N0") VNĐ</span>
					</p>

					<div class="d-flex align-items-center mt-3" style="gap:10px;">
						<label for="quantity" style="margin:0; font-weight:500;"><i class="fa fa-sort-numeric-asc"></i> Số lượng:</label>
						<input id="quantity" type="number" value="1" min="1" style="width:70px; padding:5px; border:1px solid #ccc; border-radius:5px;" />

						<button type="button"
								class="btn btn-primary btn-lg add-to-cart"
								data-id="@Model.ProductID"
								style="display:flex; align-items:center; gap:5px; background:#27ae60; border:none; padding:10px 20px; border-radius:5px; font-weight:600;">
							<i class="fa fa-shopping-cart"></i> Thêm vào giỏ
						</button>
					</div>
				</div>
			</div>

		</div><!--/product-details-->

		<div class="category-tab shop-details-tab">
			<!--category-tab-->
			<div class="col-sm-12">

				<ul class="nav nav-tabs">
					<li class="active"><a href="#details" data-toggle="tab">Sản Phẩm Tương tự</a></li>
					<li><a href="#reviews" data-toggle="tab">Đánh giá</a></li>


				</ul>

			</div>
			<div class="tab-content">
				<!-- Tab sản phẩm tương tự -->
				<div class="tab-pane fade active in" id="details">
					@if (ViewBag.RelatedProducts != null && ViewBag.RelatedProducts.Count > 0)
					{
						foreach (var item in ViewBag.RelatedProducts)
						{
							var productImages = item.ProductImage as IEnumerable<WebBanHang.Models.ProductImagesModel>;
							var mainImage = productImages?.FirstOrDefault(x => x.IsMain)
							?? productImages?.FirstOrDefault();
							<div class="col-sm-4">
								<div class="product-image-wrapper">
									<div class="single-products">
										<div class="productinfo text-center">
											<img src="@(mainImage != null
                                    ? "/media/products/" + mainImage.ImageUrl
                                    : "/images/no-image-available.jpg")"
												 alt="@item.NameProduct"
												 style="max-height:200px; object-fit:contain;" />
											<h2>@item.Price.ToString("N0") VNĐ</h2>
											<p>@item.NameProduct</p>
											<p>Thương hiệu: @item.Brand?.NameBrand</p>
											<a class="btn btn-default view-details"
											   href="@Url.Action("DetailProduct", "Product", new { id = item.ProductID })">
												<i class="fa fa-info-circle"></i> Chi tiết
											</a>
										</div>
									</div>
								</div>
							</div>
						}
					}
					else
					{
						<p>Không có sản phẩm cùng thương hiệu.</p>
					}
				</div>

				<!-- Tab Reviews -->
				<!-- Tab Reviews -->
				<div class="tab-pane fade" id="reviews">
					<!-- Tiêu đề -->
					<h3 class="mb-4" style="border-bottom:2px solid #f1f1f1; padding-bottom:10px; font-weight:700; color:#333;">
						<i class="fa fa-star" style="color:#f39c12; margin-right:8px;"></i> Đánh giá
					</h3>

					<!-- Form gửi review -->
					@{
						var username = Context.Session.GetString("Username");
					}

					@if (!string.IsNullOrEmpty(username))
					{
						<!-- Form gửi review -->
						<div id="review-form" class="mb-4 p-3" style="border:1px solid #eee; border-radius:10px; background:#fafafa;">
							<textarea id="review-content" placeholder="Viết đánh giá" class="form-control mb-2" rows="3"></textarea>
							<select id="review-rating" class="form-control mb-2">
								<option value="5">⭐⭐⭐⭐⭐</option>
								<option value="4">⭐⭐⭐⭐</option>
								<option value="3">⭐⭐⭐</option>
								<option value="2">⭐⭐</option>
								<option value="1">⭐</option>
							</select>
							<button type="button" id="submit-review" data-product="@Model.ProductID" class="btn btn-success">Gửi đánh giá</button>
						</div>
					}
					else
					{
						<p>Vui lòng <a href="@Url.Action("Login", "Account")">đăng nhập</a> để gửi đánh giá.</p>
					}



					<!-- Danh sách review -->
					<div id="review-container">
						@if (Model.ProductReviews != null && Model.ProductReviews.Any())
						{
							foreach (var r in Model.ProductReviews.OrderByDescending(r => r.CreatedAt))
							{
								<div class="review-item mb-3 p-3" style="border:1px solid #eee; border-radius:8px; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.03);">
									<div class="d-flex justify-content-between align-items-center mb-2">
										<strong>@r.UserName</strong>
										<small class="text-muted">@r.CreatedAt.ToString("dd/MM/yyyy HH:mm")</small>
									</div>
									<div class="mb-2">
										@for (int i = 0; i < r.Rating; i++)
										{
											<i class="fa fa-star" style="color:#f39c12;"></i>
										}
										@for (int i = r.Rating ?? 0; i < 5; i++)
										{
											<i class="fa fa-star-o" style="color:#ccc;"></i>
										}
									</div>
									<p>@r.Content</p>
								</div>
							}
						}
						else
						{
							<p>Chưa có đánh giá nào.</p>
						}
					</div>
				</div>

				@section Scripts {
					<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
					<script>
												$(document).on('click', '#submit-review', function(){
							var productId = $(this).data('product');
						var userName = '@username';;
							var content = $('#review-content').val();
							var rating = $('#review-rating').val();

							if(content){
								$.post('/Product/AddReview',
								{ ProductId: productId, UserName: userName, Content: content, Rating: rating },
								function(data){
									$('#review-container').html(data); // Load lại review
									$('#review-content').val('');
									$('#review-rating').val('5'); // reset rating
								});
							} else {
								alert('Nhập nội dung đánh giá!');
							}
						});

					</script>
				}


			</div>


		</div>
	</div>
